<html lang="en-US">
	<head>
		<meta charset="UTF-8">
		<script src="lib/jquery-3.5.1.min.js"></script>
		<script src="assets/pokeApiParsing.js"></script>
		<script>
			const LAST_SESSION_NAME = "lastSession";
			let poke = [];
			
			$(document).ready(function() {
				if(window.localStorage.getItem(LAST_SESSION_NAME)) {
					//TODO enable last session button
				}
				//window.localStorage.setItem("key", "val");
				
				//===========
				console.log("on ready");
				loadGens(function(gens) {
					let rows = [];
					for(let i = 0; i < gens.length; i++) {
						//Create the tags for generations obtained from the api
						let row = document.createElement("tr");
						let col = document.createElement("td");
						let cbx = document.createElement("input");
						cbx.type = "checkbox";
						cbx.id = "gen" + gens[i].genNum + "Check";
						$(cbx).attr("genNum", gens[i].genNum);
						let label = document.createElement("label");
						$(label).attr("for", cbx.id);
						label.innerText = gens[i].genName;
						
						//Append the elements to each other leaving the row as base element
						$(row).append(col);
						let jqCol = $(col);
						jqCol.append(cbx);
						jqCol.append(label);
						rows.push(row);
					}
					//Add the rows to the generation selection modal
					$("#genCheckboxes").append(rows);
					
					$("#genModal").show();
					$("#loadingModal").hide();
				});
			});
			
			function handleLoadGensClick() {
				let selectedGens = [];
				$("#genCheckboxes [type=checkbox]:checked").each(function(index, genBox) {
					selectedGens.push(+$(genBox).attr("genNum"));
				});
				if(selectedGens.length > 0) {
					$("#loadingModal").show();
					loadPokemonFromGens(selectedGens, refreshContainer);
				}
			}
			
			function refreshContainer(loadedPoke) {
				poke = loadedPoke;
				let mainContainer = $("#mainContainer");
				mainContainer.children().detach()
				
				for (const id in poke) {
					if (poke.hasOwnProperty(id)) {
						const element = poke[id];
						let row = document.createElement("tr");
						let imgTd = document.createElement("td");
						let img = document.createElement("img");
						img.src = element.spriteUrl;
						imgTd.append(img);
						let nameTd = document.createElement("td");
						nameTd.innerHTML = element.name;
						row.append(imgTd);
						row.append(nameTd);
						mainContainer.append(row);
					}
				}
				$("#genModal").hide();
				$("#loadingModal").hide();
			}
		</script>
		<link rel="stylesheet" href="assets/main.css">
	</head>
	<body>
		<div class="spinnerBox" id="loadingModal">
			<div class="modalBg"></div>
			<img src="assets/Ball.PNG" alt="Loading..." class="spinner"></img>
		</div>
		<div class="modalBox" id="genModal" style="display: none;">
			<div class="modalBg"></div>
			<div class="genSelectBox">
				Select generations to load
				
				<table id="genCheckboxes">
					<!-- Here will appear the generations after loading -->
				</table>
				
				<button onclick="handleLoadGensClick()">Load!</button>
			</div>
		</div>
		list
		<table id="mainContainer">
			
		</table>
	</body>
</html>